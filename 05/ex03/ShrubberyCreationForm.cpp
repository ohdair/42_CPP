/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   ShrubberyCreationForm.cpp                          :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: jaewpark <jaewpark@student.42seoul.kr>     +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2022/07/23 16:58:34 by jaewpark          #+#    #+#             */
/*   Updated: 2022/07/23 18:56:36 by jaewpark         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "ShrubberyCreationForm.hpp"

int ShrubberyCreationForm::sSign = 145;
int ShrubberyCreationForm::sExec = 137;

ShrubberyCreationForm::ShrubberyCreationForm(void) : Form("Default Shrubbery Creation", sSign, sExec), target("Default")
{
    std::cout << CLRYEL << "ShrubberyCreationForm" << CLREND << *this << CLRYEL << "has been defaultly constructed" << CLREND << std::endl;
}
ShrubberyCreationForm::ShrubberyCreationForm(std::string name) : Form("Shrubbery Creation", sSign, sExec), target(name)
{
    std::cout << CLRYEL << "ShrubberyCreationForm" << CLREND << *this << CLRYEL << "has been constructed" << CLREND << std::endl;
}
ShrubberyCreationForm::ShrubberyCreationForm(const ShrubberyCreationForm& form) : Form(form.getName(), form.getGradeToSign(), form.getGradeToExecute()), target(form.getTarget())
{
    std::cout << CLRYEL << "ShrubberyCreationForm" << CLREND << *this << CLRYEL << "has been copied" << CLREND << std::endl;
}
ShrubberyCreationForm::~ShrubberyCreationForm(void)
{
    std::cout << "ShrubberyCreationForm has beed destroyed" << std::endl;
}
ShrubberyCreationForm& ShrubberyCreationForm::operator=(const ShrubberyCreationForm& form)
{
    this->target = form.getTarget();
    return *this;
}

std::string ShrubberyCreationForm::getTarget(void) const
{
    return this->target;
}

const char* ShrubberyCreationForm::FailedOpenFileException::what() const throw()
{
    std::string error("the robotomy failed\n");
    error.insert(0, CLRRED).append(CLREND);
    const char *newError = error.c_str();
	return (newError);
}

void ShrubberyCreationForm::execute(Bureaucrat const & executor) const
{
    std::string tree =                                                                                                         
"                                                                                                    \n"
"                                                                                                    \n"
"                                                   ,.                                               \n"
"                                                .. ~-  ,. ,,,.                                      \n"
"                                                ,--,-,,,,-,-,,.,                                    \n"
"                                                ,,--,--,--,,-,--..                                  \n"
"                                          ,,,, ,,---,--,,,,--,--,..                                 \n"
"                            ,.            ,~,-------,,-,,,,,,,---~-                                 \n"
"                            ,,.           ,,,-~,,-,-,,,,,--,,,,,-:~ .   .  .,                       \n"
"                             . .,   .    .,-,,.,,-,---,,,,,---,-~-;--. .-..-,                       \n"
"                          .,,,.,-.,,,,.  .~~------,,,--,,-----,-~~:~-..,,-,,.- ... ..               \n"
"                        ..,,,,,,..,, .,..,:~-------,,,,,,-----~~~~~-.,--,-,,--.,,,,-.               \n"
"                       ..,--,,,~-,,-------~;--,,,------,,,,,,~~:~:::~--,,,,,---,,.--                \n"
"                       ,,,-,,,.,,,,--,,~~-~~--~--~-~----,,-,:-~:~:;;~--,-,,-,-,,-..,                \n"
"              . ..     .,--,,.,,,-,,--.~~~--:-~-~~~~-~-~-,-,~-:;;::~--~,,,,,,-,--,~,                \n"
"              ..,,    .---,-,,,,,,,,,,---::;;;:-~~:~-:-~~--~:~:!;!;~:,--,---,~----, .               \n"
"           .,..,,...   --~-,,,,,,,,--,--~:;;;!:~~~!!;;;:::~~::;!!!;;;-~-------~-~~~:,               \n"
"           ..,,,--,...,~--~-,,,,,,,~~--~~:;;!;::~~;!;!!!!;::!!*!*!;;;::~--~---~:::-.                \n"
"           ..,-,,,.,.,--~--.,~,,--,---,~:~~:!!;:;;;;:!***!;;!!!!*!;!;!;!::::;~;;::-~, ,             \n"
"            ,--,-,-,,---~-~-,---,-,--~-:::;!!**:;!*;:!!!!;;!!!*!*!;;;;;;:~:;;~~:~-....-,,           \n"
"            .-,-,---,--,,------~----~-~::::!:!!;!!!!!!!!;;:;!!!;!!;;~--~,.-:~-~-,~,-,...            \n"
"            ,,-~,~:~:~---,~------~-~~~~:~:;,-;!;!!;:~~~~~;;;;;;!!;;~--~--,,-,,,,.,-~,--,-           \n"
"              .,-~-:~~::~-::-----:,-~~~::;!:;~:~~-:~---,-~:;;;;!!!:~~-,,,------,~-~~~-~~,           \n"
"                ,, ,.:::;:~:~-~--~~:;~~:;:!-~-,,,,,,-,------:;;!!!~~--,,-,,,,-,--,-----~-.          \n"
"                     ~:~;!;~~~~~~::;;~;!!!;,,,,--,,,,,,-~---~:!;;;:~---~,,,,,,,~,----~::;.          \n"
"                 .. .-::!!!::~~~;!!;;;;!;:-,-,,,,,-,,,,,-~---~~:;:~,--~~----,,,.~-----;;-:          \n"
"              .. ,,,.---!!;;;;;~:!!;;:;;;:----,,,,,,,,--,---,~~:;:;:~~-,-,,-,,-,,---~~~:~-~.        \n"
"           .,,,,.,,-,~~,-::;!*;::!!!!;;;;~,-,----,-,,-,-~~-~::~:!;;;:~---,--,-,,--,:;~-~:..         \n"
"          ...,,-,,,,.,-,~;::!!!;;!!!!!;;;~----~~~----~-~~:--~::~::;:::~---~:-~~--,-~-~;:,           \n"
"        ..,-,,,-,,,,,---~:::!;!!!*****!!;~-:----~--,--~~~;~-:~~-~::~~;:::~~:~~~--~~~-:;-~.          \n"
"       .,,,-,----,,,,,,,-~~;;!;;!**=***!:~--~-~~~----~-:;!::!:---:---;;;::;;~::~:::-~:--.           \n"
"        ~:-~~-,-,--,,----,-:;!;!**==*=*!:;;-;:;;*!~!!;;!!*;!!;---~~:-,:!*;;;-:~,:: ~~,  .           \n"
"       ,-~----,,,,,----.,--~;!!*******==*;;::;!!*!****!*!****!~-,,,~--~;;-:~,,,,...,-,:. .          \n"
"     ..,-~~~---,-,---,-,,~~::!!*****!***!!!!;;!!*!!!*!::;***!!;:---;;;:;----,-,-,,,,-:;,,, . -,,    \n"
"     ..~-~~;~---,--,,,,--::;;*****;!:;:::;!!!!!!!:;;!!!:!!****!;;;~!!!;,,,,,-~--,,,,,,,-,,.,~.~.    \n"
"    .-:::~~::-,~----,---~:;~,:!***~;~;~--~;:~~-::-~:~;;;!;!!**!!!;;;;;:---,,-~--,,,.--,,,---~..     \n"
"    .,:;;:::;:-~::-~-~--~:!~:;;!!!:::~--,-----,,,.~,,,-:-::~;;**!;!;:;~~-~-,-~-,---,,,,-,-,,:-..    \n"
"    -~:;;;!:;~~:::~:~~~~:;!;;:!:;;;-,~-:.,,--,--,--,,--,,-,-~;!!!*!!;;:~-,,,,-~-,,--,-~,,~,~;:,-    \n"
"   .~~-;!;!;;;:~~::~~~~:;;!;:~:;;~~---,--,---,,--,,,---,---:;;!***!!!!;;~:~:~-~~,,-,-,,,,-,,--~-    \n"
"    -,,~;;:::;;:~:;::::::;:;;;;;:~:---,,-,,,,,--,,,,,,-,,,,,~::!**!!!*!;:::::-~-,--,--,---~-----..  \n"
"    .,~-:;:~!!;;;;;!!;;;;:~:;;~~~-----,~-,,-,-~,-,--,---,,,~~-:!!!*,~;!!::~-:--,,~,,-,,~~-,~~~:~-,  \n"
"        ,~;!!!!!;:;!*!;;:;:~;~-,-~-,,,-:~--,~-----~-----,---~-:;!!;;,,*!;:::~~~;~~,~~,,,-~-~:~:;,   \n"
"         -~~;;!!;;;*=**;:::;:~~,----,,,,------,--~--:~~---:-~~-:;:!!;***;:;;:~:;~~~-~~~~~-~;~-;;,   \n"
"         .  ,.~-:!**=**;~:;;~~~-~-,----,------~~~~-::-~~~:~,~~,~~:!!!*!*!;;::~~:--~-::~:~~~;-::: ,  \n"
"         .,,-- ,!**==*=!!:~:;~~-~-,-~,-,,----:;~,:~~~~~--,~--:;;:;;::-~:!!;!!~:;~:;;;~~,-~~--~:~~-  \n"
"      .-.-~~~--~~!!***=**;:;;;:-~~~::,--,~:~~:~~!::::~-,,--~---~;;;;~-~~:;!!!!!:~::~~-~~:~-~~;;--,,.\n"
"      .-~~-,,~~::;;;!*=*=*;;;!;;~,-::~:~:;;:~:~;!!!;:-------,-~~;:;----~::!**=****!:~:;;;:~:;;;~-.  \n"
"    ,-~~-,,--:;!~--:!!**==*;;:;;::;;!;;:::---:;!!;;:;;---~~;::!*~-,,--~~:-!*======*:;!!!!;:;;!;:--  \n"
"    ,-~~~~~--~~~-~~:;;!;**!;;;::;;:;!;;:::~-:~;!**!!;;;~-:;;;!!;;::--,-~~;;;!***!!!!!!!!!!!!!!;;;~. \n"
"   -~--~~~-~~:~~-:::;-;!****;;;:::;:::::;;;:;;!!:***!;;:::~:!!;!;;:-~~:;:::~~::~~;;;!!;;!!!!*!;:!-. \n"
"   ...~:::~-~~~~---:!~:!**==!!!;:::;;:;;;::!!!==;!=**=*:~;::!;*;!;;:;;*;;:~,-,~~:***!;~;!!;;*:;-.-. \n"
"     .,~::;~:;!~~~~~;!*****=*;;!!;**!*!!;;;!!!=*;!==*=*:~:-~;=$=*!;;;!:~!;:~-----!*;!!!!!!--~;,-..  \n"
"      .~~;::!!!;;;;:!****=**!;:;;!****!!!!==*!==!;==!!**!!:;===!;!!***!;!!!~,----~::;::;~:,-!,-,.   \n"
"       . --~;;!!!::!*!*****=!;;;:!*!!*!!*!====*=*!=$*!**==*=$=!:;**===!!!!:~;:--,--~:~;;~~:....,    \n"
"           ,::::!*;!;!*******;*!;!*!~:*!*;!======!=$=****=$$=!~*=*=**!!!!!::;~---~~;;;:--.          \n"
"           ,:~,~;!;!;;!!;!**!!!;;;!!:;**=*!*======$$=*!*==$==**===!;;;!!!!::;~-~~-::-,-~,           \n"
"            ~. -:;;;;;:~:!!;;;!;;:;!~~:!*===***===$===*========**!;;;;;!!~:;;~-~~,,-. .-            \n"
"               -::;;:~  ~;;::;;;;:~:.,,:!!*==**===*****=$======*:~~::!;!;---~ .--.~-   .            \n"
"                ~,..-.  --~,-::~~;~~  .-,::;=***==****==$====!~:~~-~-:~~,. .,  .., .                \n"
"                .    .   .---~~-.-~,    ,- .~***==****=$$===*,,-,. ..~,..   .                       \n"
"                            ,. . ,,         .;$**==***======...,      .                             \n"
"                                             ,*=**=**======:                                        \n"
"                                              ,******=====*,                                        \n"
"                                               ~*=***=**==;.                                        \n"
"                                               .!****=**==~                                         \n"
"                                               .:**!**!*=*~                                         \n"
"                                                :*!!*!!*=*~                                         \n"
"                                                :*!;!;!***~                                         \n"
"                                                ~*!;!;!***~                                         \n"
"                                                ~!;;!:!***:                                         \n"
"                                                ~!;;;:!*!*:                                         \n"
"                                               .~;;;;:!*!*;                                         \n"
"                                               .:;;;;:!*!*!.                                        \n"
"                                               .;;:;;;!*!*!-                                        \n"
"                                               ,!;;;:;!*!*!;.                                       \n"
"                                               :!;!;:;!=!!!!-                                       \n"
"                                              -!;;!;:;!=*!!!!.                                      \n"
"                                          ..,:!;;!!;:;*=*!!;!;,                                     \n"
"                                        .-:;!!:;!*!;;;===**!!!;~,                                   \n"
"                                      .:!*==*;;***!!;!=$==***!*!!;,                                 \n"
"                                     .,.  .;!!****!!!**~,~;!!!!!!;-                                 \n"
"                                         ,:~~~~,.~::;:,       ...                                   \n"
"                                         .       .....                                              \n"
"                                                                                                    \n"
"                                                                                                    \n"
"                                                                                                    \n";
    if (this->getSign() == false) {
        throw (Form::UnsignedFormException());
    } else if (executor.getGrade() > this->getGradeToExecute()) {
        std::cout << CLRVIO << "Execution failed : " << CLREND << std::endl;
        throw (Form::GradeTooLowException());
    }
    std::ofstream ofs(this->target + "_shrubbery");
    if (ofs.fail())
        throw (ShrubberyCreationForm::FailedOpenFileException());
    ofs << tree;
    ofs.close();
    std::cout << "Create a file " << this->target << "_shrubbery in the working directory\n";
}